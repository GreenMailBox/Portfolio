<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title"></title>
    <style>
        /* Modern styles with purple background */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0; /* Light gray background */
            color: #333; /* Dark text color */
        }
        header {
            background-color: #6a0dad; /* Purple header background */
            color: #fff; /* White text color */
            padding: 20px;
            text-align: center;
        }
        main {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #fff; /* White background for main content */
            border-radius: 10px; /* Rounded corners */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Box shadow for depth */
        }
        article {
            padding: 20px;
        }
        h1, h2, h3 {
            color: #6a0dad; /* Purple headings */
        }
        p {
            margin-bottom: 20px;
            line-height: 1.8; /* Slightly increased line height for readability */
        }
        footer {
            background-color: #6a0dad; /* Purple footer background */
            color: #fff; /* White text color */
            text-align: center;
            padding: 20px 0;
        }
        pre {
            background-color: #f9f9f9; /* Light gray background for code box */
            padding: 10px;
            border-radius: 5px; /* Rounded corners */
            overflow-x: auto; /* Enable horizontal scrolling */
            font-size: 14px; /* Adjust font size */
            line-height: 1.4; /* Adjust line height */
        }
    </style>
</head>
<body>
    <header>
        <h1 id="title">Powershell Security Check</h1>
        <p>Date: April 23, 2024</p>
    </header>
    <main>
        <article>
            <h2 id="title">Powershell Security Check</h2>
            <p id="summary">Powershell Security Check Generator: designed to get system information and do a variety of security checks on the system: including but not limited to checking for Firewall status, user accounts, and network connections/ports </p>
            <!-- Code Box for Project -->

            <pre>
                # Function to check for pending reboots
function Test-PendingReboot {
    # Check if there are pending file rename operations, indicating a pending reboot
    $pendingFileRenames = Get-ChildItem -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager' |
                          Get-ItemProperty |
                          Where-Object { $_.PendingFileRenameOperations -ne $null }
    
    return [bool]($pendingFileRenames)
}

# Function to get detailed system information
function Get-DetailedSystemInformation {
    $osInfo = Get-CimInstance -ClassName Win32_OperatingSystem
    $processorInfo = Get-CimInstance -ClassName Win32_Processor
    $memoryInfo = Get-CimInstance -ClassName Win32_PhysicalMemory
    $diskInfo = Get-CimInstance -ClassName Win32_LogicalDisk

    # Calculate total physical memory
    if ($memoryInfo.Count -gt 1) {
        $totalMemory = ($memoryInfo | Measure-Object -Property Capacity -Sum).Sum
    } else {
        $totalMemory = $memoryInfo.Capacity
    }

    $systemInfo = @"
=== System Information ===
Operating System: $($osInfo.Caption) $($osInfo.Version), $($osInfo.OSArchitecture)
Manufacturer: $($osInfo.Manufacturer)
Model: $($osInfo.Model)
System Type: $($osInfo.SystemType)
Processor: $($processorInfo.Name)
Number of Processors: $($processorInfo.NumberOfCores)
Total Physical Memory: $([math]::Round($totalMemory / 1GB, 2)) GB
Disk Information:
$($diskInfo | ForEach-Object { "Drive $($_.DeviceID): $($($_.Size / 1GB) -as [int]) GB Free" })
"@

    return $systemInfo
}

# Function to check for Windows Defender status
function Get-WindowsDefenderStatus {
    $defenderStatus = Get-CimInstance -Namespace "root\SecurityCenter2" -ClassName AntivirusProduct | Where-Object { $_.displayName -eq "Windows Defender" }

    if ($defenderStatus -ne $null) {
        return "Enabled"
    } else {
        return "Disabled"
    }
}

# Function to check for Windows Firewall status
function Get-WindowsFirewallStatus {
    $firewallStatus = (Get-NetFirewallProfile | Where-Object { $_.Name -eq "Domain" }).Enabled

    if ($firewallStatus) {
        return "Enabled"
    } else {
        return "Disabled"
    }
}

# Security Check PowerShell Script

# Function to perform security checks
function Perform-SecurityChecks {
    # Get detailed system information
    $systemInfo = Get-DetailedSystemInformation

    # Check for pending reboot
    $pendingReboot = Test-PendingReboot
    $pendingRebootString = if ($pendingReboot) { 'Yes' } else { 'No' }

    # 2. User Account Checks
    $userAccounts = Get-WmiObject Win32_UserAccount | Select-Object Name, Disabled, LastLogin

    # 3. Software Inventory
    $softwareInventory = Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* |
                         Where-Object { $_.DisplayName -ne $null } |
                         Select-Object DisplayName, DisplayVersion

    # 4. Network Connections
    $networkConnections = Get-NetTCPConnection | Select-Object LocalAddress, LocalPort, RemoteAddress, RemotePort, State
    $listeningPorts = @{} # Initialize an empty hashtable for listening ports

    try {
        $listeningPorts = Get-NetTCPListener | Select-Object Port
    } catch {
        Write-Warning "Get-NetTCPListener is not available on this system."
    }

    # 5. Security Policy Analysis
    $passwordPolicy = "Password policy information is not available on this system."
    $accountLockoutPolicy = "Account lockout policy information is not available on this system."

    # 6. Vulnerability Checks
    $weakPasswords = Get-WmiObject Win32_UserAccount | Where-Object { $_.PasswordExpires -eq $false -and $_.PasswordAge -ge 365 } | Select-Object Name
    $openShares = Get-WmiObject Win32_Share | Where-Object { $_.Path -ne $null -and $_.Description -ne $null } | Select-Object Name, Path, Description
    $outdatedSoftware = Get-WmiObject -Class Win32_Product | Select-Object Name, Version | Where-Object { $_.Version -match "^[0-9]+\." -and [version]$_.Version -lt [version]'1.0' }
    $defenderStatus = Get-WindowsDefenderStatus
    $firewallStatus = Get-WindowsFirewallStatus

    # 7. Output and Reporting
    $report = @"
$systemInfo

=== Security Check Results ===
Pending Reboot: $pendingRebootString

User Account Checks:
$userAccounts

Software Inventory:
$softwareInventory

Network Connections:
$networkConnections
Listening Ports:
$listeningPorts

Password Policy:
$passwordPolicy
Account Lockout Policy:
$accountLockoutPolicy

Weak Passwords:
$weakPasswords

Open Shares:
$openShares

Outdated Software:
$outdatedSoftware

Windows Defender Status: $defenderStatus
Windows Firewall Status: $firewallStatus
"@

    # Write report to file
    $reportPath = "C:\code\SecurityCheckReport_$(Get-Date -Format 'yyyyMMdd_HHmmss').txt"
    $report | Out-File -FilePath $reportPath

    Write-Host "Security check results have been saved to: $reportPath"
}

# Perform security checks
Perform-SecurityChecks



            </pre>
        </article>
    </main>
    <footer>
        <p>&copy; 2024 Sample Projects. All rights reserved.</p>
    </footer>
</body>
</html>
